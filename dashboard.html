<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBVIU4-cNma6fZCef2BQaGOo307TGBDk50",
    authDomain: "attendance311.firebaseapp.com",
    projectId: "attendance311",
    storageBucket: "attendance311.appspot.com",
    messagingSenderId: "564903256212",
    appId: "1:564903256212:web:37dae9a02e39abbf3dd481",
    measurementId: "G-NZEEX42J3P"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadAttendanceWithNames() {
    const attendanceSnapshot = await getDocs(collection(db, "attendance"));
    const table = document.getElementById("attendance-table");

    for (const docSnap of attendanceSnapshot.docs) {
      const uid = docSnap.id;
      const data = docSnap.data();

      // Fetch user name from users collection
      const userDoc = await getDoc(doc(db, "users", uid));
      const userData = userDoc.exists() ? userDoc.data() : {};
      const name = userData.name || "Unknown";
      const roll = userData.roll || "-";

      // Create a row
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${name}</td>
        <td>${roll}</td>
        <td>${uid}</td>
        <td>${data.date || "-"}</td>
        <td>${data.status || "Present"}</td>
      `;
      table.appendChild(row);
    }
  }

  loadAttendanceWithNames();
</script>
